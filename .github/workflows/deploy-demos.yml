name: Deploy - Demos
run-name: üöÄ Deploy - Demos

on: workflow_dispatch

jobs:
  deployment:
    runs-on: ubuntu-latest
    env:
      NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
      NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
    steps:
      - name: ‚öôÔ∏è Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: ‚öôÔ∏è Set BRAND_NAME environment variable from repo name
        run: echo BRAND_NAME=${{ github.event.repository.name }} | cut -d '-' -f1 >> $GITHUB_ENV

      - name: ‚¨áÔ∏è Checkout template
        uses: actions/checkout@v4
        with:
          path: ${{ env.BRAND_NAME }}/nextjs-mui-free

      - name: ‚¨áÔ∏è Checkout scripts
        uses: actions/checkout@v4
        with:
          repository: themeselection/automation-scripts
          token: ${{ secrets.GH_PAT }}
          path: automation-scripts

      - name: ‚¨áÔ∏è Install packages in automation-scripts dir
        working-directory: automation-scripts/nextjs
        run: pnpm i

      - name: ‚¨áÔ∏è Install packages in typescript version
        working-directory: ${{ env.BRAND_NAME }}/nextjs-mui-free/typescript-version
        run: pnpm i

      - name: ‚¨áÔ∏è Install netlify CLI
        working-directory: ${{ env.BRAND_NAME }}/nextjs-mui-free/typescript-version
        run: pnpm i -D netlify-cli

      - name: üîå Connect to Netlify Site
        run: netlify link

      - name: üöÄ Build & Deploy
        working-directory: ${{ env.BRAND_NAME }}/nextjs-mui-free/typescript-version
        run: pnpm netlify deploy --dir .next --prod --build
