# This configuration file was automatically generated by Gitpod et mod par Yo.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# Information : https://www.gitpod.io/docs/introduction/get-started

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

image:
  file: gitpodDevfile

github:
  prebuilds:
    # enable for the master/default branch (defaults to true)
    master: true
    # enable for all branches in this repo (defaults to false)
    branches: true
    # enable for pull requests coming from this repo (defaults to true)
    pullRequests: true
    # enable for pull requests coming from forks (defaults to false)
    pullRequestsFromForks: true
    # add a "Review in Gitpod" button as a comment to pull requests (defaults to true)
    addComment: true
    # add a "Review in Gitpod" button to pull requests (defaults to false)
    addBadge: false
    # add a label once the prebuild is ready to pull requests (defaults to false)
    addLabel: prebuilt-in-gitpod

tasks:
  # This task is run only once
  - name: Installation de openssl pour Prisma et de git pour Gitpod
    command: apt-get update && apt-get install -y openssl git

  - name: Yarn preinstall
    command: yarn preinstall

  - name: Installation de tout les modules Node avec yarn, incluant les modules de dev
    command: yarn install --frozen-lockfile

  - name: Raccourcis pour CLI SQLite3
    command: echo "#!/bin/sh\nset -x\nsqlite3 \$DATABASE_URL" > /usr/local/bin/database-cli && chmod +x /usr/local/bin/database-cli

  - name: Yarn postinstall
    command: yarn postinstall

  - name: Install Prisma
    init: |
      npx prisma generate

  - name: Install pre-commit hooks
    init: |
      pre-commit install --install-hooks
      exit 0

  - name: TypeScript
    init: yarn --network-timeout 100000 && yarn build

ports:
    - port: 3000
      onOpen: open-preview
      name: next-arretes-gestion-dev
      description: Webapp Preview Dev
      visibility: private
      protocol: https
    - port: 1337
      onOpen: open-preview
    #- port: 3001
    #  onOpen: ignore
    - port: 3306
      onOpen: ignore
    #- port: 4000
    #  onOpen: ignore
    # VNC
    #- port: 5900
    #  onOpen: ignore
    # noVNC
    #- port: 6080
    #  onOpen: ignore
    # Werft
    #- port: 7777
    #  onOpen: ignore
    #- port: 9229
    #  onOpen: ignore
    # Go proxy
    - port: 9999
      onOpen: ignore
    - port: 13001
      onOpen: ignore
    # Dev Theia
    - port: 13444
    # Used when using port-forwarding to SSH to preview environment VMs
    - port: 8022
      onOpen: ignore

vscode:
  extensions:
    - ms-azuretools.vscode-docker
    - esbenp.prettier-vscode
    - dbaeumer.vscode-eslint
    - bradlc.vscode-tailwindcss
    - EditorConfig.EditorConfig
    - golang.go
    - hashicorp.terraform
    - ms-kubernetes-tools.vscode-kubernetes-tools
    - stkb.rewrap
    - zxh404.vscode-proto3
    - matthewpi.caddyfile-support
    - heptio.jsonnet
    - timonwong.shellcheck
    - fwcd.kotlin
    - dbaeumer.vscode-eslint
    - esbenp.prettier-vscode
    - akosyakov.gitpod-monitor
    - hbenl.vscode-mocha-test-adapter
