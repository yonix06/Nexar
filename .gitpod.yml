# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

#image:
  #file: DockerDevfile #.gitpod.Dockerfile

tasks:
  - name: Initialisation en cours
    before: yarn global add pre-commit prisma sqlite3 git
    init: yarn install --frozen-lockfile && yarn build
    command: |
      if [ -f .env ]; then
        # If this workspace already has a .env, don't override it
        # Local changes survive a workspace being opened and closed
        # but they will not persist between separate workspaces for the same repo

        echo "Found .env in workspace"
      else
        # There is no .env
        if [ ! -n "${ENV}" ]; then
          # There is no $ENV from a previous workspace
          # Default to the example .env
          echo "Setting example .env"

          cp .env.example .env
        else
          # After making changes to .env, run this line to persist it to $ENV
          #   eval $(gp env -e ENV="$(base64 .env | tr -d '\n')")
          #
          # Environment variables set this way are shared between all your workspaces for this repo
          # The lines below will read $ENV and print a .env file

          echo "Restoring .env from Gitpod"

          echo "${ENV}" | base64 -d | tee .env > /dev/null
        fi
      fi
  - name: Install pre-commit hooks
    init: |
      pre-commit install --install-hooks
      exit 0
  - name: TypeScript
    init: yarn --network-timeout 100000 && yarn build

    
ports:
    - port: 3000
      onOpen: open-preview
      name: next-arretes-gestion-dev
      description: Webapp Preview Dev
      visibility: private
      protocol: https
    - port: 1337
      onOpen: open-preview
    - port: 3001
      onOpen: ignore
    - port: 3306
      onOpen: ignore
    - port: 4000
      onOpen: ignore
    # VNC
    - port: 5900
      onOpen: ignore
    # noVNC
    - port: 6080
      onOpen: ignore
    # Werft
    - port: 7777
      onOpen: ignore
    - port: 9229
      onOpen: ignore
    # Go proxy
    - port: 9999
      onOpen: ignore
    - port: 13001
      onOpen: ignore
    # Dev Theia
    - port: 13444
    # Used when using port-forwarding to SSH to preview environment VMs
    - port: 8022
      onOpen: ignore

vscode:
  extensions:
    - ms-azuretools.vscode-docker
    - esbenp.prettier-vscode
    - dbaeumer.vscode-eslint
    - bradlc.vscode-tailwindcss
    - EditorConfig.EditorConfig
    - golang.go
    - hashicorp.terraform
    - ms-kubernetes-tools.vscode-kubernetes-tools
    - stkb.rewrap
    - zxh404.vscode-proto3
    - matthewpi.caddyfile-support
    - heptio.jsonnet
    - timonwong.shellcheck
    - fwcd.kotlin
    - dbaeumer.vscode-eslint
    - esbenp.prettier-vscode
    - akosyakov.gitpod-monitor
    - hbenl.vscode-mocha-test-adapter
